# 要件ドキュメント

## 概要

ROBOTサンプルの実行時に発生したエラーを修正するため、以下の機能を実装する：
1. StrPrint関数（printf形式の文字列フォーマット）
2. CreatePicの3引数パターン（ソースピクチャーを参照して指定サイズで新規作成）
3. CapTitle(0)でメインウィンドウのタイトル設定
4. WinInfo関数の動作確認と修正（必要に応じて）

## 用語集

- **StrPrint**: printf形式のフォーマット指定子を使用して文字列を生成する関数
- **Format_Specifier**: フォーマット文字列内の変換指定子（%ld, %lx, %s, %03d等）
- **CreatePic**: ピクチャーを生成する関数。複数の呼び出しパターンをサポート
- **CapTitle**: ウィンドウのタイトルを設定する関数
- **WinInfo**: 仮想デスクトップの情報を取得する関数
- **Virtual_Desktop**: FILLYスクリプトが描画を行う仮想的な画面領域
- **Main_Window**: ウィンドウID 0で参照される、アプリケーションのメインウィンドウ

## 要件

### 要件 1: StrPrint関数の実装

**ユーザーストーリー:** 開発者として、printf形式のフォーマット指定子を使用して動的に文字列を生成したい。これにより、ファイル名の連番生成やデバッグメッセージの作成が可能になる。

#### 受け入れ基準

1.1. WHEN StrPrintがフォーマット文字列と引数で呼び出された場合、THE System SHALL フォーマット指定子に従ってフォーマットされた文字列を返す。

1.2. THE System SHALL 10進整数フォーマット用の%ldフォーマット指定子をサポートする。

1.3. THE System SHALL 16進整数フォーマット用の%lxフォーマット指定子をサポートする。

1.4. THE System SHALL 文字列フォーマット用の%sフォーマット指定子をサポートする。

1.5. THE System SHALL 10進整数フォーマット用の%dフォーマット指定子をサポートする（%ldのエイリアス）。

1.6. THE System SHALL ゼロパディング整数用の%03dなどの幅とパディング指定子をサポートする。

1.7. WHEN StrPrintがエスケープシーケンス（\n, \t, \r）で呼び出された場合、THE System SHALL それらを実際の制御文字に変換する。

1.8. WHEN StrPrintがフォーマット指定子より少ない引数で呼び出された場合、THE System SHALL クラッシュせずに適切に処理する。

1.9. WHEN StrPrintがフォーマット指定子より多い引数で呼び出された場合、THE System SHALL 余分な引数を無視する。

1.10. FOR ALL 有効なフォーマット文字列と引数について、同じ入力に対して常に同じ出力を生成する（決定性プロパティ）。

### 要件 2: CreatePicの3引数パターン対応

**ユーザーストーリー:** 開発者として、既存のピクチャーを参照しながら異なるサイズの新しいピクチャーを作成したい。これにより、元画像の一部を切り出して新しいピクチャーを作成できる。

#### 受け入れ基準

2.1. WHEN CreatePicが3つの引数（srcPicID, width, height）で呼び出された場合、THE System SHALL 指定されたサイズで新しいピクチャーを作成する。

2.2. WHEN CreatePicが3つの引数で呼び出された場合、THE System SHALL ソースピクチャーの内容を新しいピクチャーにコピーし、必要に応じてクリッピングまたはパディングを行う。

2.3. IF ソースピクチャーIDが無効な場合、THEN THE System SHALL -1を返しエラーをログに記録する。

2.4. IF 幅または高さがゼロまたは負の場合、THEN THE System SHALL -1を返しエラーをログに記録する。

2.5. THE System SHALL 既存のCreatePic(width, height)の2引数パターンを引き続きサポートする。

2.6. THE System SHALL 既存のCreatePic(srcPicID)の1引数パターンを引き続きサポートする。

### 要件 3: CapTitle関数のメインウィンドウ対応

**ユーザーストーリー:** 開発者として、CapTitle("")でアプリケーションのメインウィンドウタイトルを設定したい。これにより、FILLYスクリプトからウィンドウタイトルを制御できる。

#### 受け入れ基準

3.1. WHEN CapTitleが単一の文字列引数で呼び出された場合、THE System SHALL メインウィンドウ（ウィンドウID 0）のタイトルを設定する。

3.2. WHEN CapTitleがウィンドウID 0とタイトル文字列で呼び出された場合、THE System SHALL メインウィンドウのタイトルを設定する。

3.3. THE System SHALL ウィンドウID 0をメインアプリケーションウィンドウ（仮想デスクトップ）への参照として扱う。

3.4. IF CapTitleが無効なウィンドウID（0以外で有効なウィンドウでもない）で呼び出された場合、THEN THE System SHALL 警告をログに記録し実行を継続する。

3.5. THE System SHALL 特定のウィンドウのタイトルを設定するためのCapTitle(winID, title)を引き続きサポートする。

### 要件 4: WinInfo関数の動作確認

**ユーザーストーリー:** 開発者として、WinInfo関数で仮想デスクトップのサイズを取得したい。これにより、画面サイズに応じたレイアウト計算が可能になる。

#### 受け入れ基準

4.1. WHEN WinInfo(0)が呼び出された場合、THE System SHALL 仮想デスクトップの幅を返す。

4.2. WHEN WinInfo(1)が呼び出された場合、THE System SHALL 仮想デスクトップの高さを返す。

4.3. WHEN グラフィックスシステムが初期化されていない場合、THE System SHALL デフォルト値を返す（幅は1024、高さは768）。

4.4. IF WinInfoが無効なインデックスで呼び出された場合、THEN THE System SHALL 0を返す。
