# 開発ワークフロー

## プロジェクト固有ルール

- `go test` は必ず `-timeout` オプション付きで実行
- TFYファイル（*.TFY）はShift-JIS。参照時は `iconv -f SHIFT-JIS -t UTF-8` で変換
- サンプルファイルは正とする（sab2の未使用スクリプトのエラーは無視可）
- **サンプルタイトル名（kuma2, y_saru, robot等）をソースコードやドキュメントにハードコードしない**。サンプルは著作権のない第三者の作品であり、検証目的でのみ使用している。コメントやドキュメントの例示には汎用的な名前（`IMAGE.bmp`, `path/to/FILE.BMP` 等）を使うこと。テストコードでサンプルファイルを直接参照するパスは必然的なので許容
- **オリジナルFILLYは現代のOSでは実行できない**（Windows 3.1/95時代のソフトウェア）。正常性の判断基準：
  - `_old_implementation2` の動作との比較
  - 目視での動作確認
  - ユーザーからのフィードバック
  - **オリジナルFILLYでの動作確認を求めてはいけない**
- ドキュメントは日本語で作成
- バグ修正時、ブランチを切ってから作業開始、要件・設計に関わる内容は `specs/*/requirements.md` / `specs/*/design.md` に日本語で反映

## TDD サイクル

1. **Red** - 失敗するテストを1つ書く
2. **Green** - テストを通す最小限のコードを書く
3. **Refactor** - テストを維持しつつ設計改善
4. **Commit** - `git add .` でチェックポイント作成

## コーディング規約

- マジックナンバー禁止 → 定数化
- 設定値は環境変数/設定ファイルから
- SRP（単一責任）、DRY（重複排除）
- 早期リターンでネスト削減
- 入力サニタイズ徹底

## テスト用サンプル実行コマンド

```bash
T=30; LOG=test.log; SAMPLE=samples/title; go run ./cmd/son-et --timeout $T --log-level debug $SAMPLE > $LOG 2>&1 & PID=$!; sleep $T; kill $PID 2>/dev/null; cat $LOG
```

| 変数 | 説明 |
|------|------|
| `T` | タイムアウト秒数 |
| `LOG` | ログファイル名 |
| `SAMPLE` | サンプルディレクトリ |

macOSでは `timeout` コマンドが使えないことと、ログファイルに出力することで調査の深掘りのために再実行する必要をなくすため、このパターンを使用。
